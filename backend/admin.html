<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin - Decor Settings</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: Arial, sans-serif; background: #f5f5f5; }
    .login-container, .admin-container { max-width: 500px; margin: 50px auto; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    h1 { margin-bottom: 20px; color: #333; }
    input { width: 100%; padding: 10px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 4px; }
    button { width: 100%; padding: 12px; background: #0070f3; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; }
    button:hover { background: #0051cc; }
    .section-item { display: flex; align-items: center; justify-content: space-between; padding: 15px; border: 1px solid #eee; margin-bottom: 10px; border-radius: 4px; background: #fafafa; }
    .section-info { flex: 1; }
    .section-name { font-weight: bold; color: #333; }
    .section-controls { display: flex; gap: 10px; align-items: center; }
    .toggle { width: 50px; height: 26px; background: #ccc; border-radius: 13px; position: relative; cursor: pointer; transition: 0.3s; }
    .toggle.active { background: #4caf50; }
    .toggle::after { content: ''; position: absolute; width: 20px; height: 20px; background: white; border-radius: 50%; top: 3px; left: 3px; transition: 0.3s; }
    .toggle.active::after { left: 27px; }
    .order-input { width: 60px; padding: 5px; text-align: center; border: 1px solid #ddd; border-radius: 4px; }
    .save-btn { margin-top: 20px; }
    .hidden { display: none; }
    .logout-btn { background: #dc3545; margin-top: 10px; }
    .logout-btn:hover { background: #c82333; }
  </style>
</head>
<body>
  <div id="loginContainer" class="login-container">
    <h1>Login Admin</h1>
    <input type="text" id="username" placeholder="Username" value="admin">
    <input type="password" id="password" placeholder="Password" value="admin123">
    <button onclick="login()">Login</button>
  </div>

  <div id="adminContainer" class="admin-container hidden">
    <div style="display: flex; gap: 10px; margin-bottom: 20px;">
      <button onclick="showTab('sections')" id="sectionsTab" style="flex: 1; background: #0070f3;">Sections</button>
      <button onclick="showTab('logos')" id="logosTab" style="flex: 1; background: #666;">Client Logos</button>
    </div>
    
    <div id="sectionsContent">
      <h1>Section Settings</h1>
      <div id="sectionsList"></div>
      <button class="save-btn" onclick="saveSections()">Simpan Perubahan</button>
    </div>

    <div id="logosContent" class="hidden">
      <h1>Client Logos</h1>
      <p style="color: #666; margin-bottom: 15px; font-size: 14px;">Masukkan URL logo (satu per baris). Format: https://drive.google.com/thumbnail?id=FILE_ID&sz=w400</p>
      <textarea id="logosInput" style="width: 100%; height: 300px; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-family: monospace; font-size: 12px;"></textarea>
      <button class="save-btn" onclick="saveLogos()">Simpan Logo</button>
    </div>

    <button class="logout-btn" onclick="logout()">Logout</button>
  </div>

  <script>
    let sections = [];
    const API_URL = 'http://localhost:3001/api';

    function login() {
      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;
      
      if (username === 'admin' && password === 'admin123') {
        localStorage.setItem('isLoggedIn', 'true');
        showAdmin();
      } else {
        alert('Username atau password salah!');
      }
    }

    function logout() {
      localStorage.removeItem('isLoggedIn');
      document.getElementById('loginContainer').classList.remove('hidden');
      document.getElementById('adminContainer').classList.add('hidden');
    }

    function showAdmin() {
      document.getElementById('loginContainer').classList.add('hidden');
      document.getElementById('adminContainer').classList.remove('hidden');
      loadSections();
      loadLogos();
    }

    function showTab(tab) {
      if (tab === 'sections') {
        document.getElementById('sectionsContent').classList.remove('hidden');
        document.getElementById('logosContent').classList.add('hidden');
        document.getElementById('sectionsTab').style.background = '#0070f3';
        document.getElementById('logosTab').style.background = '#666';
      } else {
        document.getElementById('sectionsContent').classList.add('hidden');
        document.getElementById('logosContent').classList.remove('hidden');
        document.getElementById('sectionsTab').style.background = '#666';
        document.getElementById('logosTab').style.background = '#0070f3';
      }
    }

    async function loadSections() {
      try {
        const res = await fetch(`${API_URL}/sections`);
        const data = await res.json();
        sections = data.sections.sort((a, b) => a.order - b.order);
        renderSections();
      } catch (error) {
        alert('Gagal memuat data: ' + error.message);
      }
    }

    function renderSections() {
      const list = document.getElementById('sectionsList');
      list.innerHTML = sections.map((section, index) => `
        <div class="section-item">
          <div class="section-info">
            <div class="section-name">${section.name}</div>
          </div>
          <div class="section-controls">
            <input type="number" class="order-input" value="${section.order}" 
              onchange="updateOrder(${index}, this.value)">
            <div class="toggle ${section.visible ? 'active' : ''}" 
              onclick="toggleVisible(${index})"></div>
          </div>
        </div>
      `).join('');
    }

    function toggleVisible(index) {
      sections[index].visible = !sections[index].visible;
      renderSections();
    }

    function updateOrder(index, value) {
      sections[index].order = parseInt(value);
    }

    async function saveSections() {
      try {
        const res = await fetch(`${API_URL}/sections`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ sections })
        });
        
        if (res.ok) {
          alert('Perubahan berhasil disimpan!');
          loadSections();
        } else {
          alert('Gagal menyimpan perubahan');
        }
      } catch (error) {
        alert('Error: ' + error.message);
      }
    }

    async function loadLogos() {
      try {
        const res = await fetch(`${API_URL}/client-logos`);
        const data = await res.json();
        document.getElementById('logosInput').value = (data.logos || []).join('\n');
      } catch (error) {
        console.error('Gagal memuat logo:', error);
      }
    }

    async function saveLogos() {
      try {
        const logos = document.getElementById('logosInput').value
          .split('\n')
          .map(url => url.trim())
          .filter(url => url.length > 0);
        
        const res = await fetch(`${API_URL}/client-logos`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ logos })
        });
        
        if (res.ok) {
          alert('Logo berhasil disimpan!');
        } else {
          alert('Gagal menyimpan logo');
        }
      } catch (error) {
        alert('Error: ' + error.message);
      }
    }

    // Check login status
    if (localStorage.getItem('isLoggedIn') === 'true') {
      showAdmin();
    }
  </script>
</body>
</html>
